<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style id="nuxt-ui-colors">@layer base {
  :root {
  --ui-color-primary-50: var(--color-emerald-50, oklch(97.9% 0.021 166.113));
  --ui-color-primary-100: var(--color-emerald-100, oklch(95% 0.052 163.051));
  --ui-color-primary-200: var(--color-emerald-200, oklch(90.5% 0.093 164.15));
  --ui-color-primary-300: var(--color-emerald-300, oklch(84.5% 0.143 164.978));
  --ui-color-primary-400: var(--color-emerald-400, oklch(76.5% 0.177 163.223));
  --ui-color-primary-500: var(--color-emerald-500, oklch(69.6% 0.17 162.48));
  --ui-color-primary-600: var(--color-emerald-600, oklch(59.6% 0.145 163.225));
  --ui-color-primary-700: var(--color-emerald-700, oklch(50.8% 0.118 165.612));
  --ui-color-primary-800: var(--color-emerald-800, oklch(43.2% 0.095 166.913));
  --ui-color-primary-900: var(--color-emerald-900, oklch(37.8% 0.077 168.94));
  --ui-color-primary-950: var(--color-emerald-950, oklch(26.2% 0.051 172.552));
  --ui-color-secondary-50: var(--color-blue-50, oklch(97% 0.014 254.604));
  --ui-color-secondary-100: var(--color-blue-100, oklch(93.2% 0.032 255.585));
  --ui-color-secondary-200: var(--color-blue-200, oklch(88.2% 0.059 254.128));
  --ui-color-secondary-300: var(--color-blue-300, oklch(80.9% 0.105 251.813));
  --ui-color-secondary-400: var(--color-blue-400, oklch(70.7% 0.165 254.624));
  --ui-color-secondary-500: var(--color-blue-500, oklch(62.3% 0.214 259.815));
  --ui-color-secondary-600: var(--color-blue-600, oklch(54.6% 0.245 262.881));
  --ui-color-secondary-700: var(--color-blue-700, oklch(48.8% 0.243 264.376));
  --ui-color-secondary-800: var(--color-blue-800, oklch(42.4% 0.199 265.638));
  --ui-color-secondary-900: var(--color-blue-900, oklch(37.9% 0.146 265.522));
  --ui-color-secondary-950: var(--color-blue-950, oklch(28.2% 0.091 267.935));
  --ui-color-success-50: var(--color-green-50, oklch(98.2% 0.018 155.826));
  --ui-color-success-100: var(--color-green-100, oklch(96.2% 0.044 156.743));
  --ui-color-success-200: var(--color-green-200, oklch(92.5% 0.084 155.995));
  --ui-color-success-300: var(--color-green-300, oklch(87.1% 0.15 154.449));
  --ui-color-success-400: var(--color-green-400, oklch(79.2% 0.209 151.711));
  --ui-color-success-500: var(--color-green-500, oklch(72.3% 0.219 149.579));
  --ui-color-success-600: var(--color-green-600, oklch(62.7% 0.194 149.214));
  --ui-color-success-700: var(--color-green-700, oklch(52.7% 0.154 150.069));
  --ui-color-success-800: var(--color-green-800, oklch(44.8% 0.119 151.328));
  --ui-color-success-900: var(--color-green-900, oklch(39.3% 0.095 152.535));
  --ui-color-success-950: var(--color-green-950, oklch(26.6% 0.065 152.934));
  --ui-color-info-50: var(--color-blue-50, oklch(97% 0.014 254.604));
  --ui-color-info-100: var(--color-blue-100, oklch(93.2% 0.032 255.585));
  --ui-color-info-200: var(--color-blue-200, oklch(88.2% 0.059 254.128));
  --ui-color-info-300: var(--color-blue-300, oklch(80.9% 0.105 251.813));
  --ui-color-info-400: var(--color-blue-400, oklch(70.7% 0.165 254.624));
  --ui-color-info-500: var(--color-blue-500, oklch(62.3% 0.214 259.815));
  --ui-color-info-600: var(--color-blue-600, oklch(54.6% 0.245 262.881));
  --ui-color-info-700: var(--color-blue-700, oklch(48.8% 0.243 264.376));
  --ui-color-info-800: var(--color-blue-800, oklch(42.4% 0.199 265.638));
  --ui-color-info-900: var(--color-blue-900, oklch(37.9% 0.146 265.522));
  --ui-color-info-950: var(--color-blue-950, oklch(28.2% 0.091 267.935));
  --ui-color-warning-50: var(--color-yellow-50, oklch(98.7% 0.026 102.212));
  --ui-color-warning-100: var(--color-yellow-100, oklch(97.3% 0.071 103.193));
  --ui-color-warning-200: var(--color-yellow-200, oklch(94.5% 0.129 101.54));
  --ui-color-warning-300: var(--color-yellow-300, oklch(90.5% 0.182 98.111));
  --ui-color-warning-400: var(--color-yellow-400, oklch(85.2% 0.199 91.936));
  --ui-color-warning-500: var(--color-yellow-500, oklch(79.5% 0.184 86.047));
  --ui-color-warning-600: var(--color-yellow-600, oklch(68.1% 0.162 75.834));
  --ui-color-warning-700: var(--color-yellow-700, oklch(55.4% 0.135 66.442));
  --ui-color-warning-800: var(--color-yellow-800, oklch(47.6% 0.114 61.907));
  --ui-color-warning-900: var(--color-yellow-900, oklch(42.1% 0.095 57.708));
  --ui-color-warning-950: var(--color-yellow-950, oklch(28.6% 0.066 53.813));
  --ui-color-error-50: var(--color-red-50, oklch(97.1% 0.013 17.38));
  --ui-color-error-100: var(--color-red-100, oklch(93.6% 0.032 17.717));
  --ui-color-error-200: var(--color-red-200, oklch(88.5% 0.062 18.334));
  --ui-color-error-300: var(--color-red-300, oklch(80.8% 0.114 19.571));
  --ui-color-error-400: var(--color-red-400, oklch(70.4% 0.191 22.216));
  --ui-color-error-500: var(--color-red-500, oklch(63.7% 0.237 25.331));
  --ui-color-error-600: var(--color-red-600, oklch(57.7% 0.245 27.325));
  --ui-color-error-700: var(--color-red-700, oklch(50.5% 0.213 27.518));
  --ui-color-error-800: var(--color-red-800, oklch(44.4% 0.177 26.899));
  --ui-color-error-900: var(--color-red-900, oklch(39.6% 0.141 25.723));
  --ui-color-error-950: var(--color-red-950, oklch(25.8% 0.092 26.042));
  --ui-color-neutral-50: var(--color-slate-50, oklch(98.4% 0.003 247.858));
  --ui-color-neutral-100: var(--color-slate-100, oklch(96.8% 0.007 247.896));
  --ui-color-neutral-200: var(--color-slate-200, oklch(92.9% 0.013 255.508));
  --ui-color-neutral-300: var(--color-slate-300, oklch(86.9% 0.022 252.894));
  --ui-color-neutral-400: var(--color-slate-400, oklch(70.4% 0.04 256.788));
  --ui-color-neutral-500: var(--color-slate-500, oklch(55.4% 0.046 257.417));
  --ui-color-neutral-600: var(--color-slate-600, oklch(44.6% 0.043 257.281));
  --ui-color-neutral-700: var(--color-slate-700, oklch(37.2% 0.044 257.287));
  --ui-color-neutral-800: var(--color-slate-800, oklch(27.9% 0.041 260.031));
  --ui-color-neutral-900: var(--color-slate-900, oklch(20.8% 0.042 265.755));
  --ui-color-neutral-950: var(--color-slate-950, oklch(12.9% 0.042 264.695));
  }
  :root, .light {
  --ui-primary: var(--ui-color-primary-500);
  --ui-secondary: var(--ui-color-secondary-500);
  --ui-success: var(--ui-color-success-500);
  --ui-info: var(--ui-color-info-500);
  --ui-warning: var(--ui-color-warning-500);
  --ui-error: var(--ui-color-error-500);
  }
  .dark {
  --ui-primary: var(--ui-color-primary-400);
  --ui-secondary: var(--ui-color-secondary-400);
  --ui-success: var(--ui-color-success-400);
  --ui-info: var(--ui-color-info-400);
  --ui-warning: var(--ui-color-warning-400);
  --ui-error: var(--ui-color-error-400);
  }
}</style><script type="importmap">{"imports":{"#entry":"/_nuxt/B_yMmbdJ.js"}}</script><title>ブラウザで奏でる夢のDAW</title><style>article[data-v-3abee45f] :is(h2,h3,h4){scroll-margin-top:7rem}</style><style>pre code .line{display:block}</style><link rel="stylesheet" href="/_nuxt/entry.Dw65vbMF.css" crossorigin><style>@layer base {:where(.i-lucide\:copy){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cg fill='none' stroke='black' stroke-linecap='round' stroke-linejoin='round' stroke-width='2'%3E%3Crect width='14' height='14' x='8' y='8' rx='2' ry='2'/%3E%3Cpath d='M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2'/%3E%3C/g%3E%3C/svg%3E")}:where(.i-lucide\:link){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cg fill='none' stroke='black' stroke-linecap='round' stroke-linejoin='round' stroke-width='2'%3E%3Cpath d='M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71'/%3E%3Cpath d='M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71'/%3E%3C/g%3E%3C/svg%3E")}:where(.i-lucide\:share-2){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cg fill='none' stroke='black' stroke-linecap='round' stroke-linejoin='round' stroke-width='2'%3E%3Ccircle cx='18' cy='5' r='3'/%3E%3Ccircle cx='6' cy='12' r='3'/%3E%3Ccircle cx='18' cy='19' r='3'/%3E%3Cpath d='m8.59 13.51l6.83 3.98m-.01-10.98l-6.82 3.98'/%3E%3C/g%3E%3C/svg%3E")}:where(.i-simple-icons\:bluesky){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='black' d='M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8'/%3E%3C/svg%3E")}:where(.i-simple-icons\:x){display:inline-block;width:1em;height:1em;background-color:currentColor;-webkit-mask-image:var(--svg);mask-image:var(--svg);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-size:100% 100%;mask-size:100% 100%;--svg:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24'%3E%3Cpath fill='black' d='M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584l-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z'/%3E%3C/svg%3E")}}</style><link rel="preload" as="fetch" crossorigin="anonymous" href="/tidaw/_payload.json?89f751aa-3ee2-478b-8ebd-1aec6689f539"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/B_yMmbdJ.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Cz_dgn1A.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CvCEbJbA.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/D6m-UqoA.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DQxHV6WA.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Vrq17vc2.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/HNoE7rDP.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BMCqbZMl.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/D9RhAdoX.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Pxc4gybY.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CQLh8Csv.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/gGFz9DAp.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DZK3pQY0.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Bdp3Ooab.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/C8yqqNka.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Cv26RPgy.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BYHikWH7.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/DnFlPYGv.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/CW0b07Sy.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/BFWqBfMX.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/Cz7a3b-x.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/7Wmib_0R.js"><link rel="preload" as="fetch" fetchpriority="low" crossorigin="anonymous" href="/_nuxt/builds/meta/89f751aa-3ee2-478b-8ebd-1aec6689f539.json"><link rel="prefetch" as="style" crossorigin href="/_nuxt/index.IVyOMfeo.css"><link rel="prefetch" as="script" crossorigin href="/_nuxt/C2_-TaQH.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/Bzn4KY84.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/DWobKQhV.js"><meta name="description" content="React + Rust (WASM) を組み合わせてブラウザ上でリアルタイムオーディオ処理に挑む長編アーキテクチャ＆実装記。"><meta property="og:title" content="ブラウザで奏でる夢のDAW"><meta property="og:description" content="React + Rust (WASM) を組み合わせてブラウザ上でリアルタイムオーディオ処理に挑む長編アーキテクチャ＆実装記。"><meta property="og:type" content="article"><meta property="og:url" content="https://rioze.dev/tidaw"><script type="module" src="/_nuxt/B_yMmbdJ.js" crossorigin></script><script>"use strict";(()=>{const t=window,e=document.documentElement,c=["dark","light"],n=getStorageValue("localStorage","nuxt-color-mode")||"system";let i=n==="system"?u():n;const r=e.getAttribute("data-color-mode-forced");r&&(i=r),l(i),t["__NUXT_COLOR_MODE__"]={preference:n,value:i,getColorScheme:u,addColorScheme:l,removeColorScheme:d};function l(o){const s=""+o+"",a="";e.classList?e.classList.add(s):e.className+=" "+s,a&&e.setAttribute("data-"+a,o)}function d(o){const s=""+o+"",a="";e.classList?e.classList.remove(s):e.className=e.className.replace(new RegExp(s,"g"),""),a&&e.removeAttribute("data-"+a)}function f(o){return t.matchMedia("(prefers-color-scheme"+o+")")}function u(){if(t.matchMedia&&f("").media!=="not all"){for(const o of c)if(f(":"+o).matches)return o}return"light"}})();function getStorageValue(t,e){switch(t){case"localStorage":return window.localStorage.getItem(e);case"sessionStorage":return window.sessionStorage.getItem(e);case"cookie":return getCookie(e);default:return null}}function getCookie(t){const c=("; "+window.document.cookie).split("; "+t+"=");if(c.length===2)return c.pop()?.split(";").shift()}</script></head><body><div id="__nuxt" class="isolate"><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><!--[--><div class="relative flex flex-col min-h-screen bg-gradient-to-b from-neutral-950 via-neutral-900 to-neutral-950"><!--[--><ReadingProgress data-v-3abee45f></ReadingProgress><!--]--><header class="pt-14 pb-10 md:pt-20 md:pb-14"><div class="w-full max-w-(--ui-container) mx-auto px-4 sm:px-6 lg:px-8"><!--[--><!--[--><ArticleMeta title="ブラウザで奏でる夢のDAW" description="React + Rust (WASM) を組み合わせてブラウザ上でリアルタイムオーディオ処理に挑む長編アーキテクチャ＆実装記。" date="2025-09-18" reading-time="69" data-v-3abee45f></ArticleMeta><!--]--><!--]--></div></header><div class="w-full max-w-(--ui-container) mx-auto px-4 sm:px-6 lg:px-8"><!--[--><div class="grid gap-10 lg:gap-14 lg:grid-cols-[minmax(0,1fr)_280px] xl:grid-cols-[minmax(0,1fr)_320px]"><main class="min-w-0"><!--[--><article class="prose dark:prose-invert max-w-none prose-headings:scroll-mt-28" data-v-3abee45f><div data-v-3abee45f><h1 id="ブラウザで奏でる夢のdaw"><!--[-->ブラウザで奏でる夢のDAW！<!--]--></h1><blockquote><!--[--><p><!--[-->React + Rust (WASM) で挑むリアルタイムオーディオ処理の冒険記。壮大な夢と失敗、そして学びの航海ログです。<!--]--></p><!--]--></blockquote><p><!--[-->皆さん、こんにちは！フロントエンド開発の広大な海を航海している一人のエンジニアです。突然ですが、皆さんは夢を持っていますか？僕の夢は <strong><!--[-->「ブラウザ上で本格的な DAW（Digital Audio Workstation）を作ること」<!--]--></strong>。Web ブラウザという誰もが持つキャンバスの上で、自由に音楽を創造できるアプリケーションを作りたいんです。<!--]--></p><p><!--[-->「え、ブラウザで DAW？無謀じゃない？」──そう思ったあなた、一理あります。でも現代の Web 技術なら不可能じゃないはず！この長い記事は、その無謀とも言える夢に向かって突き進む、長く、時に困難で、それでも最高にエキサイティングな開発の旅の記録です。<!--]--></p><h2 id="今回の旅の武器"><a href="#今回の旅の武器"><!--[-->🧰 今回の旅の武器<!--]--></a></h2><ul><!--[--><li><!--[-->フロントエンド: React + TypeScript<!--]--></li><li><!--[-->オーディオ処理の心臓部: Rust → WebAssembly (WASM)<!--]--></li><li><!--[-->並列化: Web Worker + AudioWorklet + SharedArrayBuffer<!--]--></li><!--]--></ul><p><!--[-->読み終える頃には、「ブラウザで音が鳴る」その裏側の仕組みにどっぷり浸っているはず。そして、あなた自身の「ブラウザで何か作ってみたい！」という気持ちに火が付いていたなら最高です。🚀<!--]--></p><hr><h2 id="第一章-設計という名の航海図-最初の嵐と進路変更"><a href="#第一章-設計という名の航海図-最初の嵐と進路変更"><!--[-->第一章: 設計という名の航海図 – 最初の嵐と進路変更<!--]--></a></h2><p><!--[-->最初に立ちはだかったのは「どこまで WASM に任せるか？」問題。初期案では UI はただの入出力、ロジックも状態も全部 Rust 側に置こうとしました。しかし <strong><!--[-->「UI と密結合な状態を WASM に置くのは非効率 &amp; 複雑」<!--]--></strong> という現実にぶつかり破綻。そこで責務を再分配：<!--]--></p><table><!--[--><thead><!--[--><tr><!--[--><th><!--[-->レイヤー<!--]--></th><th><!--[-->役割<!--]--></th><!--]--></tr><!--]--></thead><tbody><!--[--><tr><!--[--><td><!--[-->React (UI)<!--]--></td><td><!--[-->描画・入力・アプリ全体の状態管理<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->Rust WASM<!--]--></td><td><!--[-->純粋な DSP（信号生成/処理）<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->Worker<!--]--></td><td><!--[-->WASM の実行環境・非同期橋渡し<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->AudioWorklet<!--]--></td><td><!--[-->超低遅延での最終出力<!--]--></td><!--]--></tr><!--]--></tbody><!--]--></table><blockquote><!--[--><p><!--[-->教訓: 「UI に近い状態は UI 側で持つ」。無理に WASM へ押し込まない。<!--]--></p><!--]--></blockquote><h2 id="第二章-三銃士-audioworklet-sharedarraybuffer-rust-wasm"><a href="#第二章-三銃士-audioworklet-sharedarraybuffer-rust-wasm"><!--[-->第二章: 三銃士 – AudioWorklet / SharedArrayBuffer / Rust WASM<!--]--></a></h2><p><!--[-->リアルタイム処理を成立させる鍵はこの 3 つの連携：<!--]--></p><ol><!--[--><li><!--[--><strong><!--[-->AudioWorklet<!--]--></strong> – メインスレッドに干渉しない低レイテンシ処理<!--]--></li><li><!--[--><strong><!--[-->SharedArrayBuffer<!--]--></strong> – コピーゼロの共有メモリ伝達<!--]--></li><li><!--[--><strong><!--[-->Rust WASM<!--]--></strong> – 高速なサンプル生成<!--]--></li><!--]--></ol><p><!--[-->特に SharedArrayBuffer は「巨大なホワイトボード」。WASM が書き、Worklet が読む──このモデルがパフォーマンスの基盤になります。<!--]--></p><h2 id="第三章-まずは小さな一歩-サイン波デモ"><a href="#第三章-まずは小さな一歩-サイン波デモ"><!--[-->第三章: まずは小さな一歩 – サイン波デモ<!--]--></a></h2><p><!--[-->最終的な DAW ではなく、最小構成（Play/Pause + 周波数スライダー + サイン波出力）から着手。はじめは TypeScript 実装で流れを作り、あとから Rust に差し替える戦略を採用。これにより初期の学習コストとデバッグコストを最小化。<!--]--></p><h2 id="第四章-オーディオエンジンの心臓を起動"><a href="#第四章-オーディオエンジンの心臓を起動"><!--[-->第四章: オーディオエンジンの心臓を起動<!--]--></a></h2><p><!--[-->セットアップ時の流れ（簡略版）：<!--]--></p><pre class="language-text"><!--[--><code>UI -&gt; Worker: SharedArrayBuffer 渡す
Worker -&gt; WASM: 初期化
Worker -&gt; Worklet: Audio 用 SAB 共有
Worklet: process() で読み出し
</code><!--]--></pre><p><!--[-->この段階では <strong><!--[-->“周波数などのパラメータをどう共有するか”<!--]--></strong> が未解決で “???” コメントが残る状態。<!--]--></p><h2 id="第五章-ui-とエンジンを繋ぐ共有状態モデル"><a href="#第五章-ui-とエンジンを繋ぐ共有状態モデル"><!--[-->第五章: UI とエンジンを繋ぐ共有状態モデル<!--]--></a></h2><p><!--[--><code><!--[-->postMessage<!--]--></code> 乱発は避けたい。そこで <code><!--[-->shared-memory-datastructures<!--]--></code> の <code><!--[-->ShareableMap<!--]--></code> を導入。これにより <strong><!--[-->Map ライクなインターフェースで共有メモリ上のパラメータを参照 / 更新<!--]--></strong> 可能に。<!--]--></p><p><!--[-->更新の仕組み：<!--]--></p><pre class="language-text"><!--[--><code>UI (Slider変更) → sharedState.set(&#39;frequency&#39;, value)
Worker loop → sharedState.get(&#39;frequency&#39;) を参照して波形生成
</code><!--]--></pre><h2 id="第六章-遅延とノイズとの戦い-リングバッファの必然"><a href="#第六章-遅延とノイズとの戦い-リングバッファの必然"><!--[-->第六章: 遅延とノイズとの戦い – リングバッファの必然<!--]--></a></h2><p><!--[-->Play/Pause の遅延と “プチッ” ノイズ。原因は巨大な 1 秒バッファと生データ書き込み方式。解決へのステップ：<!--]--></p><ol><!--[--><li><!--[-->バッファを「円形のコンベヤーベルト」= <strong><!--[-->リングバッファ<!--]--></strong> に変更<!--]--></li><li><!--[--><code><!--[-->readPointer<!--]--></code> / <code><!--[-->writePointer<!--]--></code> を <code><!--[-->Atomics<!--]--></code> で同期<!--]--></li><li><!--[-->過剰書き込み・過少読み込みを制御し XRUN を回避<!--]--></li><!--]--></ol><p><!--[-->最終的に即応性が劇的改善。残課題はフェード処理（ポップノイズ軽減）と動的バッファチューニング。<!--]--></p><h2 id="第七章-rust-wasm-への差し替え"><a href="#第七章-rust-wasm-への差し替え"><!--[-->第七章: Rust WASM への差し替え<!--]--></a></h2><p><!--[-->TypeScript のサイン波ロジックを Rust の <code><!--[-->SineOscillator<!--]--></code> へ移行。<code><!--[-->wasm-pack<!--]--></code> によるビルド → Worker 内で <code><!--[-->await init()<!--]--></code> → <code><!--[-->osc.process()<!--]--></code> という流れ。<!--]--></p><pre class="language-rust shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span>#[wasm_bindgen]
</span></span><span class="line" line="2"><span>impl SineOscillator {
</span></span><span class="line" line="3"><span>    pub fn process(&amp;mut self, length: usize, freq: f32, amp: f32) -&gt; Vec&lt;f32&gt; {
</span></span><span class="line" line="4"><span>        // サンプル生成
</span></span><span class="line" line="5"><span>    }
</span></span><span class="line" line="6"><span>}
</span></span></code><!--]--></pre><blockquote><!--[--><p><!--[-->Rust 化の利点: 多波形拡張・エフェクトチェーン・SIMD 最適化への布石。<!--]--></p><!--]--></blockquote><h2 id="学びと今後の展望"><a href="#学びと今後の展望"><!--[-->学びと今後の展望<!--]--></a></h2><table><!--[--><thead><!--[--><tr><!--[--><th><!--[-->課題<!--]--></th><th><!--[-->解決/現状<!--]--></th><th><!--[-->次の一手<!--]--></th><!--]--></tr><!--]--></thead><tbody><!--[--><tr><!--[--><td><!--[-->状態責務の錯綜<!--]--></td><td><!--[-->UI と DSP の分離<!--]--></td><td><!--[-->グローバル状態管理導入 (Pinia 等)<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->遅延<!--]--></td><td><!--[-->リングバッファ化<!--]--></td><td><!--[-->ダブルバッファ + latency hint<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->ノイズ<!--]--></td><td><!--[-->未対策<!--]--></td><td><!--[-->フェード / DC オフセット除去<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->単一オシレーター<!--]--></td><td><!--[-->動作確認段階<!--]--></td><td><!--[-->モジュール式ノードグラフ<!--]--></td><!--]--></tr><tr><!--[--><td><!--[-->手動チューニング<!--]--></td><td><!--[-->経験則<!--]--></td><td><!--[-->Telemetry + 自動調整<!--]--></td><!--]--></tr><!--]--></tbody><!--]--></table><h2 id="まとめ"><a href="#まとめ"><!--[-->まとめ<!--]--></a></h2><p><!--[-->このデモは “本格 DAW” の入り口にすぎません。これから：<!--]--></p><ul><!--[--><li><!--[-->複数トラック / ノードベースルーティング<!--]--></li><li><!--[-->エフェクト（Delay, Filter, Reverb）<!--]--></li><li><!--[-->MIDI / WebMIDI 入力<!--]--></li><li><!--[-->クリップエディタ + タイムライン<!--]--></li><li><!--[-->オフラインレンダリング<!--]--></li><!--]--></ul><p><!--[-->ここまで読んでくださり本当にありがとうございました。この記事があなたの創作エネルギーを少しでも刺激できたなら嬉しいです。<strong><!--[-->Web はまだまだ未開拓。次はあなたの番です。<!--]--></strong><!--]--></p><blockquote><!--[--><p><!--[-->🌊 行こう、ブラウザという名の海へ。<!--]--></p><!--]--></blockquote><hr><details><summary>オリジナル生ログ（クリックで展開）</summary><p><!--[-->（執筆時のラフな生ログ。読みづらさ優先でそのまま保存してあります）<!--]--></p><p><!--[-->ブラウザで奏でる夢のDAW！React + Rust(WASM)で作るリアルタイムオーディオ処理の冒険…（以下省略せず原文）<!--]--></p></details><hr><h2 id="付録-ハンズオン実装チュートリアル"><a href="#付録-ハンズオン実装チュートリアル"><!--[-->付録: ハンズオン実装チュートリアル<!--]--></a></h2><p><!--[-->記事本文は概念～アーキテクチャ寄りでした。ここでは「最小サイン波デモ」を組み立てる実践手順を整理した形でまとめ直します。<!--]--></p><h3 id="_1-プロジェクト初期化"><a href="#_1-プロジェクト初期化"><!--[-->1. プロジェクト初期化<!--]--></a></h3><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sj4cs">cd</span><span class="sZZnC"> my-daw-project
</span></span><span class="line" line="2"><span class="sScJk">npm</span><span class="sZZnC"> install
</span></span><span class="line" line="3"><span class="sJ8bj"># React + TypeScript テンプレートを Vite で用意（公式ガイド参照）
</span></span></code><!--]--></pre><h4 id="_1-1-tailwind-導入"><a href="#_1-1-tailwind-導入"><!--[-->1-1. Tailwind 導入<!--]--></a></h4><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sScJk">npm</span><span class="sZZnC"> install</span><span class="sj4cs"> -D</span><span class="sZZnC"> tailwindcss</span><span class="sZZnC"> postcss</span><span class="sZZnC"> autoprefixer
</span></span><span class="line" line="2"><span class="sScJk">npx</span><span class="sZZnC"> tailwindcss</span><span class="sZZnC"> init</span><span class="sj4cs"> -p
</span></span></code><!--]--></pre><p><!--[--><code><!--[-->tailwind.config.js<!--]--></code> とエントリー CSS に <code><!--[-->@tailwind base;<!--]--></code> などを追加。<!--]--></p><h4 id="_1-2-vite-の設定sharedarraybuffer-のための-coopcoep"><a href="#_1-2-vite-の設定sharedarraybuffer-のための-coopcoep"><!--[-->1-2. Vite の設定（SharedArrayBuffer のための COOP/COEP）<!--]--></a></h4><pre class="language-ts shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sJ8bj">// vite.config.ts
</span></span><span class="line" line="2"><span class="szBVR">import</span><span class="sVt8B"> { defineConfig } </span><span class="szBVR">from</span><span class="sZZnC"> &#39;vite&#39;
</span></span><span class="line" line="3"><span class="szBVR">import</span><span class="sVt8B"> react </span><span class="szBVR">from</span><span class="sZZnC"> &#39;@vitejs/plugin-react&#39;
</span></span><span class="line" line="4"><span emptylineplaceholder="true">
</span></span><span class="line" line="5"><span class="szBVR">export</span><span class="szBVR"> default</span><span class="sScJk"> defineConfig</span><span class="sVt8B">({
</span></span><span class="line" line="6"><span class="sVt8B">    plugins: [</span><span class="sScJk">react</span><span class="sVt8B">()],
</span></span><span class="line" line="7"><span class="sVt8B">    server: {
</span></span><span class="line" line="8"><span class="sVt8B">        headers: {
</span></span><span class="line" line="9"><span class="sZZnC">            &#39;Cross-Origin-Opener-Policy&#39;</span><span class="sVt8B">: </span><span class="sZZnC">&#39;same-origin&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="10"><span class="sZZnC">            &#39;Cross-Origin-Embedder-Policy&#39;</span><span class="sVt8B">: </span><span class="sZZnC">&#39;require-corp&#39;</span><span class="sVt8B">,
</span></span><span class="line" line="11"><span class="sVt8B">        },
</span></span><span class="line" line="12"><span class="sVt8B">    },
</span></span><span class="line" line="13"><span class="sVt8B">})
</span></span></code><!--]--></pre><h3 id="_2-ui-の骨組み"><a href="#_2-ui-の骨組み"><!--[-->2. UI の骨組み<!--]--></a></h3><pre class="language-tsx shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sJ8bj">// src/App.tsx
</span></span><span class="line" line="2"><span class="szBVR">import</span><span class="sVt8B"> React, { useState } </span><span class="szBVR">from</span><span class="sZZnC"> &#39;react&#39;
</span></span><span class="line" line="3"><span emptylineplaceholder="true">
</span></span><span class="line" line="4"><span class="szBVR">export</span><span class="szBVR"> default</span><span class="szBVR"> function</span><span class="sScJk"> App</span><span class="sVt8B">() {
</span></span><span class="line" line="5"><span class="szBVR">    const</span><span class="sVt8B"> [</span><span class="sj4cs">isPlaying</span><span class="sVt8B">, </span><span class="sj4cs">setIsPlaying</span><span class="sVt8B">] </span><span class="szBVR">=</span><span class="sScJk"> useState</span><span class="sVt8B">(</span><span class="sj4cs">false</span><span class="sVt8B">)
</span></span><span class="line" line="6"><span class="szBVR">    const</span><span class="sVt8B"> [</span><span class="sj4cs">frequency</span><span class="sVt8B">, </span><span class="sj4cs">setFrequency</span><span class="sVt8B">] </span><span class="szBVR">=</span><span class="sScJk"> useState</span><span class="sVt8B">(</span><span class="sj4cs">440</span><span class="sVt8B">)
</span></span><span class="line" line="7"><span class="szBVR">    return</span><span class="sVt8B"> (
</span></span><span class="line" line="8"><span class="sVt8B">        &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;flex flex-col items-center justify-center min-h-screen bg-gray-900 text-white gap-4&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="9"><span class="sVt8B">            &lt;</span><span class="s9eBZ">h1</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;text-3xl font-bold mb-4&quot;</span><span class="sVt8B">&gt;WASM Audio Demo&lt;/</span><span class="s9eBZ">h1</span><span class="sVt8B">&gt;
</span></span><span class="line" line="10"><span class="sVt8B">            &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;flex items-center gap-4&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="11"><span class="sVt8B">                &lt;</span><span class="s9eBZ">button
</span></span><span class="line" line="12"><span class="sScJk">                    className</span><span class="szBVR">=</span><span class="sZZnC">&quot;px-6 py-3 bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors text-xl font-semibold&quot;
</span></span><span class="line" line="13"><span class="sScJk">                    onClick</span><span class="szBVR">=</span><span class="sVt8B">{() </span><span class="szBVR">=&gt;</span><span class="sScJk"> setIsPlaying</span><span class="sVt8B">(</span><span class="szBVR">!</span><span class="sVt8B">isPlaying)}
</span></span><span class="line" line="14"><span class="sVt8B">                &gt;
</span></span><span class="line" line="15"><span class="sVt8B">                    {isPlaying </span><span class="szBVR">?</span><span class="sZZnC"> &#39;Pause&#39;</span><span class="szBVR"> :</span><span class="sZZnC"> &#39;Play&#39;</span><span class="sVt8B">}
</span></span><span class="line" line="16"><span class="sVt8B">                &lt;/</span><span class="s9eBZ">button</span><span class="sVt8B">&gt;
</span></span><span class="line" line="17"><span class="sVt8B">                &lt;</span><span class="s9eBZ">div</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;flex flex-col items-center&quot;</span><span class="sVt8B">&gt;
</span></span><span class="line" line="18"><span class="sVt8B">                    &lt;</span><span class="s9eBZ">input
</span></span><span class="line" line="19"><span class="sScJk">                        type</span><span class="szBVR">=</span><span class="sZZnC">&quot;range&quot;
</span></span><span class="line" line="20"><span class="sScJk">                        min</span><span class="szBVR">=</span><span class="sVt8B">{</span><span class="sj4cs">20</span><span class="sVt8B">}
</span></span><span class="line" line="21"><span class="sScJk">                        max</span><span class="szBVR">=</span><span class="sVt8B">{</span><span class="sj4cs">2000</span><span class="sVt8B">}
</span></span><span class="line" line="22"><span class="sScJk">                        step</span><span class="szBVR">=</span><span class="sVt8B">{</span><span class="sj4cs">1</span><span class="sVt8B">}
</span></span><span class="line" line="23"><span class="sScJk">                        className</span><span class="szBVR">=</span><span class="sZZnC">&quot;w-64 accent-blue-600&quot;
</span></span><span class="line" line="24"><span class="sScJk">                        value</span><span class="szBVR">=</span><span class="sVt8B">{frequency}
</span></span><span class="line" line="25"><span class="sScJk">                        onChange</span><span class="szBVR">=</span><span class="sVt8B">{(</span><span class="s4XuR">e</span><span class="sVt8B">) </span><span class="szBVR">=&gt;</span><span class="sScJk"> setFrequency</span><span class="sVt8B">(</span><span class="sScJk">Number</span><span class="sVt8B">(e.target.value))}
</span></span><span class="line" line="26"><span class="sVt8B">                    /&gt;
</span></span><span class="line" line="27"><span class="sVt8B">                    &lt;</span><span class="s9eBZ">span</span><span class="sScJk"> className</span><span class="szBVR">=</span><span class="sZZnC">&quot;mt-2 text-lg&quot;</span><span class="sVt8B">&gt;{frequency} Hz&lt;/</span><span class="s9eBZ">span</span><span class="sVt8B">&gt;
</span></span><span class="line" line="28"><span class="sVt8B">                &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="29"><span class="sVt8B">            &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="30"><span class="sVt8B">        &lt;/</span><span class="s9eBZ">div</span><span class="sVt8B">&gt;
</span></span><span class="line" line="31"><span class="sVt8B">    )
</span></span><span class="line" line="32"><span class="sVt8B">}
</span></span></code><!--]--></pre><h3 id="_3-audioworklet-worker-セットアップ概要"><a href="#_3-audioworklet-worker-セットアップ概要"><!--[-->3. AudioWorklet &amp; Worker セットアップ（概要）<!--]--></a></h3><pre class="language-text"><!--[--><code>UI クリックで setupAudio()
 → AudioContext 作成
 → SharedArrayBuffer 準備
 → Worklet へ sab 渡す
 → Worker 起動 / sab &amp; sampleRate 渡す
</code><!--]--></pre><h3 id="_4-共有状態に-shareablemap-を使う"><a href="#_4-共有状態に-shareablemap-を使う"><!--[-->4. 共有状態に ShareableMap を使う<!--]--></a></h3><pre class="language-ts shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="szBVR">import</span><span class="sVt8B"> { ShareableMap } </span><span class="szBVR">from</span><span class="sZZnC"> &#39;shared-memory-datastructures&#39;
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span class="szBVR">const</span><span class="sj4cs"> shared</span><span class="szBVR"> =</span><span class="szBVR"> new</span><span class="sScJk"> ShareableMap</span><span class="sVt8B">&lt;</span><span class="sj4cs">string</span><span class="sVt8B">, </span><span class="sj4cs">number</span><span class="sVt8B">&gt;()
</span></span><span class="line" line="4"><span class="sVt8B">shared.</span><span class="sScJk">set</span><span class="sVt8B">(</span><span class="sZZnC">&#39;frequency&#39;</span><span class="sVt8B">, </span><span class="sj4cs">440</span><span class="sVt8B">)
</span></span><span class="line" line="5"><span class="sVt8B">shared.</span><span class="sScJk">set</span><span class="sVt8B">(</span><span class="sZZnC">&#39;isPlaying&#39;</span><span class="sVt8B">, </span><span class="sj4cs">0</span><span class="sVt8B">)
</span></span><span class="line" line="6"><span class="sJ8bj">// worker.postMessage({ sharedMemory: shared.toTransferableState() });
</span></span></code><!--]--></pre><h3 id="_5-リングバッファの基本形"><a href="#_5-リングバッファの基本形"><!--[-->5. リングバッファの基本形<!--]--></a></h3><pre class="language-ts shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sJ8bj">// pointers: Int32Array [readIndex, writeIndex]
</span></span><span class="line" line="2"><span class="szBVR">const</span><span class="sj4cs"> readPointer</span><span class="szBVR"> =</span><span class="sVt8B"> Atomics.</span><span class="sScJk">load</span><span class="sVt8B">(pointers, </span><span class="sj4cs">0</span><span class="sVt8B">)
</span></span><span class="line" line="3"><span class="szBVR">const</span><span class="sj4cs"> writePointer</span><span class="szBVR"> =</span><span class="sVt8B"> Atomics.</span><span class="sScJk">load</span><span class="sVt8B">(pointers, </span><span class="sj4cs">1</span><span class="sVt8B">)
</span></span><span class="line" line="4"><span class="szBVR">const</span><span class="sj4cs"> availableWrite</span><span class="szBVR"> =</span><span class="sVt8B"> (readPointer </span><span class="szBVR">-</span><span class="sVt8B"> writePointer </span><span class="szBVR">-</span><span class="sj4cs"> 1</span><span class="szBVR"> +</span><span class="sVt8B"> capacity) </span><span class="szBVR">%</span><span class="sVt8B"> capacity
</span></span></code><!--]--></pre><p><!--[-->XRUN（underrun / overrun）を避けるため、読み書き距離を監視し必要なら無音埋め / 生成抑制。<!--]--></p><h3 id="_6-rust-への移行最小"><a href="#_6-rust-への移行最小"><!--[-->6. Rust への移行（最小）<!--]--></a></h3><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sScJk">cargo</span><span class="sZZnC"> new</span><span class="sZZnC"> wasm-lib</span><span class="sj4cs"> --lib
</span></span></code><!--]--></pre><p><!--[--><code><!--[-->Cargo.toml<!--]--></code>:<!--]--></p><pre class="language-toml shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span>[package]
</span></span><span class="line" line="2"><span>name = &quot;wasm-lib&quot;
</span></span><span class="line" line="3"><span>version = &quot;0.1.0&quot;
</span></span><span class="line" line="4"><span>edition = &quot;2021&quot;
</span></span><span class="line" line="5"><span emptylineplaceholder="true">
</span></span><span class="line" line="6"><span>[lib]
</span></span><span class="line" line="7"><span>crate-type = [&quot;cdylib&quot;]
</span></span><span class="line" line="8"><span emptylineplaceholder="true">
</span></span><span class="line" line="9"><span>[dependencies]
</span></span><span class="line" line="10"><span>wasm-bindgen = &quot;0.2&quot;
</span></span></code><!--]--></pre><p><!--[--><code><!--[-->src/lib.rs<!--]--></code>:<!--]--></p><pre class="language-rust shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span>use wasm_bindgen::prelude::*;
</span></span><span class="line" line="2"><span>use std::f32::consts::PI;
</span></span><span class="line" line="3"><span emptylineplaceholder="true">
</span></span><span class="line" line="4"><span>#[wasm_bindgen]
</span></span><span class="line" line="5"><span>pub struct SineOscillator {
</span></span><span class="line" line="6"><span>    phase: f32,
</span></span><span class="line" line="7"><span>    sample_rate: f32,
</span></span><span class="line" line="8"><span>}
</span></span><span class="line" line="9"><span emptylineplaceholder="true">
</span></span><span class="line" line="10"><span>#[wasm_bindgen]
</span></span><span class="line" line="11"><span>impl SineOscillator {
</span></span><span class="line" line="12"><span>    #[wasm_bindgen(constructor)]
</span></span><span class="line" line="13"><span>    pub fn new(sample_rate: f32) -&gt; SineOscillator {
</span></span><span class="line" line="14"><span>        SineOscillator { phase: 0.0, sample_rate }
</span></span><span class="line" line="15"><span>    }
</span></span><span class="line" line="16"><span emptylineplaceholder="true">
</span></span><span class="line" line="17"><span>    pub fn process(&amp;mut self, length: usize, frequency: f32, amplitude: f32) -&gt; Vec&lt;f32&gt; {
</span></span><span class="line" line="18"><span>        let mut buffer = vec![0.0; length];
</span></span><span class="line" line="19"><span>        let phase_increment = frequency / self.sample_rate;
</span></span><span class="line" line="20"><span>        for i in 0..length {
</span></span><span class="line" line="21"><span>            let sample = (self.phase * 2.0 * PI).sin();
</span></span><span class="line" line="22"><span>            buffer[i] = sample * amplitude;
</span></span><span class="line" line="23"><span>            self.phase += phase_increment;
</span></span><span class="line" line="24"><span>            if self.phase &gt;= 1.0 { self.phase -= 1.0; }
</span></span><span class="line" line="25"><span>        }
</span></span><span class="line" line="26"><span>        buffer
</span></span><span class="line" line="27"><span>    }
</span></span><span class="line" line="28"><span>}
</span></span></code><!--]--></pre><p><!--[-->ビルド:<!--]--></p><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sj4cs">cd</span><span class="sZZnC"> wasm-lib
</span></span><span class="line" line="2"><span class="sScJk">wasm-pack</span><span class="sZZnC"> build</span><span class="sj4cs"> --target</span><span class="sZZnC"> web
</span></span><span class="line" line="3"><span class="sScJk">npm</span><span class="sZZnC"> install</span><span class="sZZnC"> ../wasm-lib/pkg
</span></span></code><!--]--></pre><p><!--[-->Vite 設定追加:<!--]--></p><pre class="language-bash shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sScJk">npm</span><span class="sZZnC"> i</span><span class="sj4cs"> -D</span><span class="sZZnC"> vite-plugin-wasm</span><span class="sZZnC"> vite-plugin-top-level-await
</span></span></code><!--]--></pre><pre class="language-ts shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="sJ8bj">// vite.config.ts (抜粋)
</span></span><span class="line" line="2"><span class="szBVR">import</span><span class="sVt8B"> wasm </span><span class="szBVR">from</span><span class="sZZnC"> &#39;vite-plugin-wasm&#39;
</span></span><span class="line" line="3"><span class="szBVR">import</span><span class="sVt8B"> topLevelAwait </span><span class="szBVR">from</span><span class="sZZnC"> &#39;vite-plugin-top-level-await&#39;
</span></span><span class="line" line="4"><span class="szBVR">export</span><span class="szBVR"> default</span><span class="sScJk"> defineConfig</span><span class="sVt8B">({ plugins: [</span><span class="sScJk">react</span><span class="sVt8B">(), </span><span class="sScJk">wasm</span><span class="sVt8B">(), </span><span class="sScJk">topLevelAwait</span><span class="sVt8B">()] })
</span></span></code><!--]--></pre><h3 id="_7-worker-から-rust-呼び出し"><a href="#_7-worker-から-rust-呼び出し"><!--[-->7. Worker から Rust 呼び出し<!--]--></a></h3><pre class="language-ts shiki shiki-themes github-light github-dark" style=""><!--[--><code><span class="line" line="1"><span class="szBVR">import</span><span class="sVt8B"> init, { SineOscillator } </span><span class="szBVR">from</span><span class="sZZnC"> &#39;wasm-lib&#39;
</span></span><span class="line" line="2"><span emptylineplaceholder="true">
</span></span><span class="line" line="3"><span class="sVt8B">self.</span><span class="sScJk">onmessage</span><span class="szBVR"> =</span><span class="szBVR"> async</span><span class="sVt8B"> (</span><span class="s4XuR">e</span><span class="sVt8B">) </span><span class="szBVR">=&gt;</span><span class="sVt8B"> {
</span></span><span class="line" line="4"><span class="szBVR">    const</span><span class="sVt8B"> { </span><span class="sj4cs">sab</span><span class="sVt8B">, </span><span class="sj4cs">sampleRate</span><span class="sVt8B">, </span><span class="sj4cs">sharedMemory</span><span class="sVt8B">, </span><span class="sj4cs">pointersSAB</span><span class="sVt8B"> } </span><span class="szBVR">=</span><span class="sVt8B"> e.data
</span></span><span class="line" line="5"><span class="szBVR">    await</span><span class="sScJk"> init</span><span class="sVt8B">()
</span></span><span class="line" line="6"><span class="szBVR">    const</span><span class="sj4cs"> osc</span><span class="szBVR"> =</span><span class="szBVR"> new</span><span class="sScJk"> SineOscillator</span><span class="sVt8B">(sampleRate)
</span></span><span class="line" line="7"><span class="sJ8bj">    // 生成 → SAB 書き込みループへ
</span></span><span class="line" line="8"><span class="sVt8B">}
</span></span></code><!--]--></pre><hr><h2 id="今後の小さな改善アイデア"><a href="#今後の小さな改善アイデア"><!--[-->今後の小さな改善アイデア<!--]--></a></h2><ul><!--[--><li><!--[-->再生/停止時に 2–5 ms フェードを入れてポップ除去<!--]--></li><li><!--[-->動的バッファチューニング（負荷に応じてターゲットフィルレベル変更）<!--]--></li><li><!--[-->Parameter smoothing (exponential ramp) でスライダー急変のノイズ低減<!--]--></li><li><!--[-->SIMD / multiple oscillators 合成（Rust 側）<!--]--></li><!--]--></ul><hr><p><!--[-->お疲れさまでした！付録を含め最後まで読んでくださり感謝です 🙏<!--]--></p><style>html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html pre.shiki code .sj4cs, html code.shiki .sj4cs{--shiki-default:#005CC5;--shiki-dark:#79B8FF}html pre.shiki code .sZZnC, html code.shiki .sZZnC{--shiki-default:#032F62;--shiki-dark:#9ECBFF}html pre.shiki code .sScJk, html code.shiki .sScJk{--shiki-default:#6F42C1;--shiki-dark:#B392F0}html pre.shiki code .sJ8bj, html code.shiki .sJ8bj{--shiki-default:#6A737D;--shiki-dark:#6A737D}html pre.shiki code .szBVR, html code.shiki .szBVR{--shiki-default:#D73A49;--shiki-dark:#F97583}html pre.shiki code .sVt8B, html code.shiki .sVt8B{--shiki-default:#24292E;--shiki-dark:#E1E4E8}html pre.shiki code .s9eBZ, html code.shiki .s9eBZ{--shiki-default:#22863A;--shiki-dark:#85E89D}html pre.shiki code .s4XuR, html code.shiki .s4XuR{--shiki-default:#E36209;--shiki-dark:#FFAB70}</style></div><div class="mt-12 flex flex-wrap gap-3" data-v-3abee45f><!--[--><span class="font-medium inline-flex items-center text-xs px-2 py-1 gap-1 rounded-md bg-primary/10 text-primary" data-v-3abee45f><!--[--><!----><!--]--><!--[-->#WebAudio<!--]--><!--[--><!----><!--]--></span><span class="font-medium inline-flex items-center text-xs px-2 py-1 gap-1 rounded-md bg-primary/10 text-primary" data-v-3abee45f><!--[--><!----><!--]--><!--[-->#Rust<!--]--><!--[--><!----><!--]--></span><span class="font-medium inline-flex items-center text-xs px-2 py-1 gap-1 rounded-md bg-primary/10 text-primary" data-v-3abee45f><!--[--><!----><!--]--><!--[-->#WASM<!--]--><!--[--><!----><!--]--></span><span class="font-medium inline-flex items-center text-xs px-2 py-1 gap-1 rounded-md bg-primary/10 text-primary" data-v-3abee45f><!--[--><!----><!--]--><!--[-->#React<!--]--><!--[--><!----><!--]--></span><span class="font-medium inline-flex items-center text-xs px-2 py-1 gap-1 rounded-md bg-primary/10 text-primary" data-v-3abee45f><!--[--><!----><!--]--><!--[-->#Architecture<!--]--><!--[--><!----><!--]--></span><!--]--></div><UDivider class="my-10" data-v-3abee45f></UDivider><div class="text-sm text-neutral-500 flex flex-col gap-2" data-v-3abee45f><p data-v-3abee45f>この記事が気に入ったらシェアしてくれると嬉しいです 🙌</p><div class="flex gap-2" data-v-3abee45f><!--[--><!--[--><button type="button" data-v-3abee45f class="rounded-md font-medium inline-flex items-center disabled:cursor-not-allowed aria-disabled:cursor-not-allowed disabled:opacity-75 aria-disabled:opacity-75 transition-colors px-2 py-1 text-xs gap-1 ring ring-inset ring-accented text-default bg-default hover:bg-elevated active:bg-elevated disabled:bg-default aria-disabled:bg-default focus:outline-none focus-visible:ring-2 focus-visible:ring-inverted"><!--[--><!--[--><span class="iconify i-simple-icons:x shrink-0 size-4" aria-hidden="true" style=""></span><!--]--><!--[-->X<!--]--><!--[--><!----><!--]--><!--]--></button><!--]--><!--]--><!--[--><!--[--><button type="button" data-v-3abee45f class="rounded-md font-medium inline-flex items-center disabled:cursor-not-allowed aria-disabled:cursor-not-allowed disabled:opacity-75 aria-disabled:opacity-75 transition-colors px-2 py-1 text-xs gap-1 ring ring-inset ring-accented text-default bg-default hover:bg-elevated active:bg-elevated disabled:bg-default aria-disabled:bg-default focus:outline-none focus-visible:ring-2 focus-visible:ring-inverted"><!--[--><!--[--><span class="iconify i-simple-icons:bluesky shrink-0 size-4" aria-hidden="true" style=""></span><!--]--><!--[-->Bluesky<!--]--><!--[--><!----><!--]--><!--]--></button><!--]--><!--]--><!--[--><!--[--><button type="button" data-v-3abee45f class="rounded-md font-medium inline-flex items-center disabled:cursor-not-allowed aria-disabled:cursor-not-allowed disabled:opacity-75 aria-disabled:opacity-75 transition-colors px-2 py-1 text-xs gap-1 ring ring-inset ring-accented text-default bg-default hover:bg-elevated active:bg-elevated disabled:bg-default aria-disabled:bg-default focus:outline-none focus-visible:ring-2 focus-visible:ring-inverted"><!--[--><!--[--><span class="iconify i-lucide:copy shrink-0 size-4" aria-hidden="true" style=""></span><!--]--><!--[-->Copy<!--]--><!--[--><!----><!--]--><!--]--></button><!--]--><!--]--></div></div></article><!--]--></main><aside class="hidden lg:block sticky self-start top-28 h-max"><!--[--><ArticleToc class="max-h-[70vh] overflow-y-auto" data-v-3abee45f></ArticleToc><div class="mt-6 space-y-3" data-v-3abee45f><!--[--><!--[--><button type="button" data-v-3abee45f class="rounded-md font-medium inline-flex items-center disabled:cursor-not-allowed aria-disabled:cursor-not-allowed disabled:opacity-75 aria-disabled:opacity-75 transition-colors px-2.5 py-1.5 text-sm gap-1.5 w-full justify-center text-primary bg-primary/10 hover:bg-primary/15 active:bg-primary/15 focus:outline-none focus-visible:bg-primary/15 disabled:bg-primary/10 aria-disabled:bg-primary/10"><!--[--><!--[--><span class="iconify i-lucide:share-2 shrink-0 size-5" aria-hidden="true" style=""></span><!--]--><!--[-->共有<!--]--><!--[--><!----><!--]--><!--]--></button><!--]--><!--]--><!--[--><!--[--><button type="button" data-v-3abee45f class="rounded-md font-medium inline-flex items-center disabled:cursor-not-allowed aria-disabled:cursor-not-allowed disabled:opacity-75 aria-disabled:opacity-75 transition-colors px-2.5 py-1.5 text-sm gap-1.5 w-full justify-center text-primary hover:bg-primary/10 active:bg-primary/10 focus:outline-none focus-visible:bg-primary/10 disabled:bg-transparent aria-disabled:bg-transparent dark:disabled:bg-transparent dark:aria-disabled:bg-transparent"><!--[--><!--[--><span class="iconify i-lucide:link shrink-0 size-5" aria-hidden="true" style=""></span><!--]--><!--[-->リンクをコピー<!--]--><!--[--><!----><!--]--><!--]--></button><!--]--><!--]--></div><!--]--></aside></div><!--]--></div><footer class="mt-20 py-10 border-t border-white/5"><div class="w-full max-w-(--ui-container) mx-auto px-4 sm:px-6 lg:px-8 text-xs text-neutral-500 flex flex-col gap-2 md:flex-row md:items-center md:justify-between"><!--[--><p> © 2025 rioze.dev – All rights reserved. </p><p class="opacity-70"> Built with Nuxt, @nuxt/content, and Rust fueled dreams. </p><!--]--></div></footer></div><!--]--><!--]--><!--[--><!--]--><!--v-if--><!--]--><!--[--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[--><!--]--><!--v-if--><!--]--><!--[--><!--]--><!--]--><!--]--></div><div id="teleports"></div><script type="application/json" data-nuxt-data="nuxt-app" data-ssr="true" id="__NUXT_DATA__" data-src="/tidaw/_payload.json?89f751aa-3ee2-478b-8ebd-1aec6689f539">[{"state":1,"once":8,"_errors":9,"serverRendered":5,"path":11,"prerenderedAt":12},["Reactive",2],{"$scolor-mode":3,"$stoasts":7},{"preference":4,"value":4,"unknown":5,"forced":6},"system",true,false,[],["Set"],["ShallowReactive",10],{"content:tidaw":-1},"/tidaw",1758192149053]</script><script>window.__NUXT__={};window.__NUXT__.config={public:{content:{wsUrl:""},mdc:{components:{prose:true,map:{}},headings:{anchorLinks:{h1:false,h2:true,h3:true,h4:true,h5:false,h6:false}}}},app:{baseURL:"/",buildId:"89f751aa-3ee2-478b-8ebd-1aec6689f539",buildAssetsDir:"/_nuxt/",cdnURL:""}}</script></body></html>